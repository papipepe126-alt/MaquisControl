<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Maquis Manager Cloud V3 ☁️ Premium</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root { 
            --bg: #0a0a0a; 
            --card: #1a1a1a; 
            --card-hover: #222; 
            --primary: #FFD700; 
            --primary-dark: #ccac00; 
            --danger: #FF4444; 
            --success: #00C851; 
            --info: #33b5e5; 
            --text: #fff;
            --text-secondary: #aaa;
            --accent: #FFD70020;
            --shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            --shadow-light: 0 5px 15px rgba(0, 0, 0, 0.3);
            --gradient: linear-gradient(135deg, #1a1a1a, #0a0a0a);
            --gradient-primary: linear-gradient(135deg, #FFD700, #ccac00);
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; }
        body { background: var(--bg); color: var(--text); font-family: 'Poppins', sans-serif; margin: 0; padding: 0; overflow-x: hidden; }

        /* LOADING SPINNER */
        #loader { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: var(--bg); z-index: 10000; display: flex; flex-direction: column; align-items: center; justify-content: center; transition: opacity 0.5s ease; }
        .spinner { border: 4px solid rgba(255, 215, 0, 0.2); border-top: 4px solid var(--primary); border-radius: 50%; width: 50px; height: 50px; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        /* TOAST */
        .toast { position: fixed; bottom: 100px; left: 50%; transform: translateX(-50%); background: var(--card); color: var(--text); padding: 15px 25px; border-radius: 50px; box-shadow: var(--shadow); z-index: 5000; opacity: 0; transition: opacity 0.3s ease, transform 0.3s ease; max-width: 80%; text-align: center; border-left: 4px solid var(--success); }
        .toast.show { opacity: 1; transform: translateX(-50%) translateY(-10px); }
        .toast.error { border-left-color: var(--danger); }
        .toast.info { border-left-color: var(--info); }

        /* LOGIN */
        #login-screen { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: var(--gradient); z-index: 5000; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 20px; }
        .login-container { width: 100%; max-width: 450px; display: flex; flex-direction: column; align-items: center; }
        .login-box { width: 100%; text-align: center; background: rgba(26, 26, 26, 0.8); padding: 40px; border-radius: 20px; box-shadow: var(--shadow); backdrop-filter: blur(10px); border: 1px solid rgba(255, 215, 0, 0.1); }
        .login-logo { font-size: 40px; color: var(--primary); margin-bottom: 10px; }
        .login-title { font-size: 24px; font-weight: 700; color: var(--primary); margin-bottom: 5px; }
        .login-subtitle { color: var(--text-secondary); font-size: 14px; margin-bottom: 30px; }
        .login-input { width: 100%; padding: 18px; margin: 10px 0; border-radius: 12px; border: 1px solid rgba(255, 215, 0, 0.2); background: rgba(34, 34, 34, 0.7); color: white; font-size: 16px; transition: var(--transition); }
        .login-input:focus { border-color: var(--primary); background: rgba(34, 34, 34, 0.9); box-shadow: 0 0 0 3px rgba(255, 215, 0, 0.1); }
        .btn-auth { width: 100%; padding: 18px; background: var(--gradient-primary); color: black; font-weight: 600; border: none; border-radius: 12px; cursor: pointer; margin-top: 15px; font-size: 16px; transition: var(--transition); box-shadow: 0 5px 15px rgba(255, 215, 0, 0.3); }
        .btn-auth:hover { transform: translateY(-3px); box-shadow: 0 8px 20px rgba(255, 215, 0, 0.4); }
        .btn-secondary { background: transparent; border: 1px solid rgba(255, 215, 0, 0.3); color: var(--primary); box-shadow: none; }
        .btn-secondary:hover { background: rgba(255, 215, 0, 0.1); }

        /* APP MAIN */
        #app-container { display: none; padding: 20px; padding-bottom: 100px; max-width: 1200px; margin: 0 auto; }
        header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; padding: 15px 20px; background: var(--card); border-radius: 15px; box-shadow: var(--shadow-light); }
        .brand { font-size: 24px; font-weight: 700; color: var(--primary); letter-spacing: 1px; display: flex; align-items: center; gap: 10px; }
        .user-info { display: flex; align-items: center; gap: 15px; }
        .user-role { background: rgba(255, 215, 0, 0.2); color: var(--primary); padding: 5px 12px; border-radius: 20px; font-size: 12px; font-weight: 600; }
        .logout-btn { background: var(--card-hover); color: var(--danger); border: 1px solid var(--danger); padding: 8px 15px; border-radius: 8px; font-size: 14px; cursor: pointer; transition: var(--transition); display: flex; align-items: center; gap: 5px; }
        
        /* TABS */
        .tab-nav { display: flex; gap: 10px; margin-bottom: 20px; overflow-x: auto; padding-bottom: 5px; }
        .tab-btn { background: var(--card); border: none; color: var(--text-secondary); padding: 12px 20px; border-radius: 10px; cursor: pointer; font-weight: 500; transition: var(--transition); white-space: nowrap; display: flex; align-items: center; gap: 8px; }
        .tab-btn.active { background: var(--gradient-primary); color: black; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }

        /* STATS */
        .dashboard-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .stat-card { background: var(--card); padding: 25px; border-radius: 20px; text-align: center; border: 1px solid rgba(255, 215, 0, 0.1); transition: var(--transition); box-shadow: var(--shadow-light); position: relative; overflow: hidden; }
        .stat-card::before { content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 5px; background: var(--gradient-primary); }
        .stat-card.main { grid-column: span 2; background: var(--gradient); border: 1px solid rgba(255, 215, 0, 0.2); }
        .stat-card-icon { font-size: 24px; margin-bottom: 10px; color: var(--primary); }
        .stat-card h3 { margin: 0 0 10px 0; font-size: 14px; color: var(--text-secondary); text-transform: uppercase; font-weight: 500; }
        .stat-card .val { font-size: 32px; font-weight: 700; margin: 10px 0; color: var(--text); }
        .stat-card.main .val { font-size: 42px; color: var(--primary); }
        .stat-card .change { font-size: 14px; margin-top: 5px; display: flex; align-items: center; justify-content: center; gap: 5px; }
        .stat-card .change.positive { color: var(--success); }
        .stat-card .change.negative { color: var(--danger); }

        /* CHARTS & PRODUCTS */
        .chart-container { background: var(--card); padding: 25px; border-radius: 20px; margin-bottom: 30px; box-shadow: var(--shadow-light); }
        .chart-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .chart-title { font-size: 18px; font-weight: 600; color: var(--text); }
        .chart-wrapper { position: relative; height: 300px; }
        
        .section-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .section-title { font-size: 18px; font-weight: 600; color: var(--text); display: flex; align-items: center; gap: 10px; }
        .btn-add { background: var(--gradient-primary); color: black; border: none; padding: 10px 15px; border-radius: 10px; cursor: pointer; font-weight: 600; display: flex; align-items: center; gap: 5px; transition: var(--transition); }
        
        .search-container { margin-bottom: 20px; position: relative; }
        .search-input { width: 100%; padding: 15px 50px 15px 20px; border-radius: 15px; border: 1px solid rgba(255, 215, 0, 0.2); background: var(--card); color: var(--text); font-size: 16px; }
        .search-icon { position: absolute; right: 20px; top: 50%; transform: translateY(-50%); color: var(--text-secondary); }
        
        .product-list { display: grid; gap: 15px; }
        .product-item { display: flex; justify-content: space-between; align-items: center; background: var(--card); padding: 20px; border-radius: 15px; border: 1px solid rgba(255, 215, 0, 0.1); transition: var(--transition); }
        .product-info { display: flex; align-items: center; gap: 15px; }
        .product-icon { width: 50px; height: 50px; background: var(--gradient-primary); border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 20px; color: black; }
        .product-name { font-weight: 600; font-size: 18px; margin-bottom: 5px; }
        .product-price { color: var(--success); font-size: 16px; font-weight: 500; }
        .product-actions { display: flex; align-items: center; gap: 15px; }
        .stock-badge { background: var(--card-hover); padding: 8px 15px; border-radius: 10px; font-size: 14px; color: var(--text-secondary); display: flex; align-items: center; gap: 5px; }
        .stock-badge.low { background: rgba(255, 68, 68, 0.2); color: var(--danger); }
        .product-buttons { display: flex; gap: 10px; }
        .btn-sell, .btn-edit, .btn-delete { border: none; padding: 10px; border-radius: 10px; cursor: pointer; transition: var(--transition); display: flex; align-items: center; gap: 5px; color: white; }
        .btn-sell { background: var(--success); font-weight: 600; padding: 10px 15px; }
        .btn-edit { background: var(--info); }
        .btn-delete { background: var(--danger); }

        /* LOGS */
        .log-section { margin-top: 30px; background: var(--card); padding: 25px; border-radius: 20px; }
        .log-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .log-list { max-height: 400px; overflow-y: auto; }
        .log-item { display: flex; justify-content: space-between; font-size: 14px; padding: 15px 0; border-bottom: 1px solid rgba(255, 215, 0, 0.1); color: var(--text-secondary); }
        .log-content { display: flex; align-items: center; gap: 10px; }
        .log-icon { width: 36px; height: 36px; border-radius: 50%; display: flex; align-items: center; justify-content: center; }
        .log-icon.sale { background: rgba(0, 200, 81, 0.2); color: var(--success); }
        .log-icon.expense { background: rgba(255, 68, 68, 0.2); color: var(--danger); }
        .log-icon.restock { background: rgba(51, 181, 229, 0.2); color: var(--info); }
        .log-amount { font-weight: 600; }
        .log-filter-btn { background: var(--card-hover); border: none; color: var(--text-secondary); padding: 8px 15px; border-radius: 8px; cursor: pointer; }
        .log-filter-btn.active { background: var(--gradient-primary); color: black; }

        /* ADMIN */
        .admin-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .admin-card { background: var(--card); padding: 25px; border-radius: 20px; border: 1px solid rgba(255, 215, 0, 0.1); }
        .admin-card-title { font-size: 18px; font-weight: 600; color: var(--text); margin-bottom: 20px; display: flex; align-items: center; gap: 10px; }
        .employee-list { display: grid; gap: 15px; }
        .employee-item { display: flex; align-items: center; gap: 15px; padding: 15px; background: var(--card-hover); border-radius: 12px; }
        .employee-avatar { width: 50px; height: 50px; border-radius: 50%; background: var(--gradient-primary); display: flex; align-items: center; justify-content: center; font-size: 20px; color: black; font-weight: 600; }
        .employee-info { flex: 1; }
        .employee-name { font-weight: 600; margin-bottom: 3px; }
        .employee-role { font-size: 14px; color: var(--text-secondary); }
        .btn-employee { background: none; border: none; color: var(--text-secondary); cursor: pointer; font-size: 18px; padding: 5px; }
        .btn-employee:hover { color: var(--danger); }
        .export-buttons { display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; }
        .btn-export { background: var(--card-hover); border: 1px solid rgba(255, 215, 0, 0.2); color: var(--text); padding: 15px; border-radius: 12px; cursor: pointer; font-weight: 500; display: flex; flex-direction: column; align-items: center; gap: 10px; }
        
        /* MODALS */
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 6000; align-items: center; justify-content: center; backdrop-filter: blur(5px); padding: 20px; }
        .modal-content { background: var(--card); padding: 30px; border-radius: 20px; width: 100%; max-width: 500px; border: 1px solid rgba(255, 215, 0, 0.2); position: relative; animation: modalSlideIn 0.3s ease; }
        @keyframes modalSlideIn { from { transform: translateY(-50px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px; }
        .modal-title { font-size: 20px; font-weight: 600; color: var(--text); display: flex; align-items: center; gap: 10px; }
        .close-modal { font-size: 24px; color: var(--text-secondary); cursor: pointer; background: none; border: none; }
        .form-group { margin-bottom: 20px; }
        .form-label { display: block; margin-bottom: 8px; font-size: 14px; font-weight: 500; color: var(--text-secondary); }
        .form-input, .form-select { width: 100%; padding: 15px; border-radius: 10px; border: 1px solid rgba(255, 215, 0, 0.2); background: var(--card-hover); color: var(--text); font-size: 16px; }
        .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .modal-footer { display: flex; justify-content: flex-end; gap: 10px; margin-top: 25px; }
        .btn-cancel { background: var(--card-hover); color: var(--text); border: 1px solid rgba(255, 215, 0, 0.2); padding: 12px 20px; border-radius: 10px; cursor: pointer; font-weight: 500; }
        .btn-submit { background: var(--gradient-primary); color: black; border: none; padding: 12px 20px; border-radius: 10px; cursor: pointer; font-weight: 600; }

        /* NAV */
        .bottom-bar { position: fixed; bottom: 0; left: 0; width: 100%; background: var(--card); padding: 15px 20px; display: flex; justify-content: space-around; border-top: 1px solid rgba(255, 215, 0, 0.1); z-index: 4000; }
        .nav-btn { background: none; border: none; color: var(--text-secondary); cursor: pointer; display: flex; flex-direction: column; align-items: center; font-size: 12px; gap: 5px; padding: 5px 10px; border-radius: 10px; }
        .nav-btn.active { color: var(--primary); }
        .nav-btn i { font-size: 20px; }
        
        @media (max-width: 768px) {
            .dashboard-grid, .admin-grid, .form-row, .export-buttons { grid-template-columns: 1fr; }
            .stat-card.main { grid-column: span 1; }
            .product-actions { flex-direction: column; gap: 10px; }
            .product-buttons { width: 100%; justify-content: space-between; }
        }
    </style>
</head>
<body>

    <div id="loader">
        <div class="spinner"></div>
        <p style="margin-top:15px; font-size:14px; color:#666;">Connexion Sécurisée...</p>
    </div>
    <div id="toast" class="toast"></div>

    <div id="login-screen">
        <div class="login-container">
            <div class="login-box">
                <div class="login-logo"><i class="fa-solid fa-champagne-glasses"></i></div>
                <h1 class="login-title">MAQUIS CLOUD</h1>
                <p class="login-subtitle">Gestion Premium V3</p>
                <input type="email" id="email" class="login-input" placeholder="Email">
                <input type="password" id="password" class="login-input" placeholder="Mot de passe">
                <button class="btn-auth" id="login-btn">SE CONNECTER</button>
                <button class="btn-auth btn-secondary" id="register-btn">Créer un compte</button>
                <p id="auth-msg" style="color:var(--danger); margin-top:15px; font-size:14px;"></p>
            </div>
        </div>
    </div>

    <div id="app-container">
        <header>
            <div class="brand"><i class="fa-solid fa-champagne-glasses"></i> MAQUIS<span style="color:white">MANAGER</span></div>
            <div class="user-info">
                <div class="user-role" id="user-role">Employé</div>
                <button class="logout-btn" id="logout-btn"><i class="fa-solid fa-power-off"></i> Déconnexion</button>
            </div>
        </header>

        <div class="tab-nav">
            <button class="tab-btn active" data-tab="dashboard"><i class="fa-solid fa-chart-line"></i> Tableau de bord</button>
            <button class="tab-btn" data-tab="sales"><i class="fa-solid fa-cash-register"></i> Ventes</button>
            <button class="tab-btn" data-tab="products"><i class="fa-solid fa-box"></i> Produits</button>
            <button class="tab-btn" data-tab="reports"><i class="fa-solid fa-file-alt"></i> Rapports</button>
            <button class="tab-btn admin-only" data-tab="admin" style="display:none;"><i class="fa-solid fa-user-shield"></i> Admin</button>
        </div>

        <div class="tab-content active" id="tab-dashboard">
            <div class="dashboard-grid">
                <div class="stat-card main">
                    <div class="stat-card-icon"><i class="fa-solid fa-wallet"></i></div>
                    <h3>Net en Caisse (Réel)</h3>
                    <div class="val" id="net-display">0 FCFA</div>
                    <div class="change positive"><i class="fa-solid fa-arrow-up"></i> +12% par rapport à hier</div>
                </div>
                <div class="stat-card">
                    <div class="stat-card-icon"><i class="fa-solid fa-chart-line"></i></div>
                    <h3>Ventes du jour</h3>
                    <div class="val" id="ca-display">0</div>
                    <div class="change positive"><i class="fa-solid fa-arrow-up"></i> +8% par rapport à hier</div>
                </div>
                <div class="stat-card">
                    <div class="stat-card-icon"><i class="fa-solid fa-money-bill-transfer"></i></div>
                    <h3>Dépenses du jour</h3>
                    <div class="val" id="expense-display">0</div>
                    <div class="change negative"><i class="fa-solid fa-arrow-down"></i> -5% par rapport à hier</div>
                </div>
                <div class="stat-card">
                    <div class="stat-card-icon"><i class="fa-solid fa-shopping-cart"></i></div>
                    <h3>Ventes totales</h3>
                    <div class="val" id="sales-count">0</div>
                    <div class="change positive"><i class="fa-solid fa-arrow-up"></i> +15% par rapport à hier</div>
                </div>
                <div class="stat-card">
                    <div class="stat-card-icon"><i class="fa-solid fa-box"></i></div>
                    <h3>Produits en stock</h3>
                    <div class="val" id="stock-count">0</div>
                    <div class="change negative"><i class="fa-solid fa-arrow-down"></i> 3 produits en rupture</div>
                </div>
            </div>
            <div class="chart-container">
                <div class="chart-header">
                    <h3 class="chart-title">Performance mensuelle</h3>
                    <div class="chart-options"><button class="chart-option active">Recettes</button></div>
                </div>
                <div class="chart-wrapper"><canvas id="monthly-chart"></canvas></div>
            </div>
            <div class="chart-container">
                <div class="chart-header">
                    <h3 class="chart-title">Ventes par produit</h3>
                    <div class="chart-options"><button class="chart-option active">Top 5</button></div>
                </div>
                <div class="chart-wrapper"><canvas id="product-chart"></canvas></div>
            </div>
        </div>

        <div class="tab-content" id="tab-sales">
            <div class="section-header">
                <h3 class="section-title"><i class="fa-solid fa-cash-register"></i> Ventes rapides</h3>
                <button class="btn-add" id="quick-sale-btn"><i class="fa-solid fa-plus"></i> Vente manuelle</button>
            </div>
            <div class="search-container">
                <input type="text" id="product-search" class="search-input" placeholder="Rechercher un produit...">
                <i class="fa-solid fa-search search-icon"></i>
            </div>
            <div class="product-list" id="products-list"><p style="text-align:center; color:#666;">Chargement...</p></div>
            <div class="log-section">
                <div class="log-header">
                    <h3 class="log-title">Historique des transactions</h3>
                    <div class="log-filter">
                        <button class="log-filter-btn active" data-filter="all">Toutes</button>
                        <button class="log-filter-btn" data-filter="sales">Ventes</button>
                        <button class="log-filter-btn" data-filter="expenses">Dépenses</button>
                    </div>
                </div>
                <div class="log-list" id="logs-list"></div>
            </div>
        </div>

        <div class="tab-content" id="tab-products">
            <div class="section-header">
                <h3 class="section-title"><i class="fa-solid fa-box"></i> Gestion des produits</h3>
                <button class="btn-add" id="add-product-btn"><i class="fa-solid fa-plus"></i> Ajouter un produit</button>
            </div>
            <div class="search-container">
                <input type="text" id="product-search-admin" class="search-input" placeholder="Rechercher un produit...">
                <i class="fa-solid fa-search search-icon"></i>
            </div>
            <div class="product-list" id="products-list-admin"><p style="text-align:center; color:#666;">Chargement...</p></div>
        </div>

        <div class="tab-content" id="tab-reports">
            <div class="section-header"><h3 class="section-title"><i class="fa-solid fa-file-alt"></i> Rapports et analyses</h3></div>
            <div class="dashboard-grid">
                <div class="admin-card">
                    <h3 class="admin-card-title"><i class="fa-solid fa-calendar-alt"></i> Rapport quotidien</h3>
                    <button class="btn-auth" id="daily-report-btn" style="width: 100%;"><i class="fa-solid fa-download"></i> Télécharger</button>
                </div>
                <div class="admin-card">
                    <h3 class="admin-card-title"><i class="fa-solid fa-calendar-week"></i> Rapport hebdomadaire</h3>
                    <button class="btn-auth" id="weekly-report-btn" style="width: 100%;"><i class="fa-solid fa-download"></i> Télécharger</button>
                </div>
                <div class="admin-card">
                    <h3 class="admin-card-title"><i class="fa-solid fa-calendar"></i> Rapport mensuel</h3>
                    <button class="btn-auth" id="monthly-report-btn" style="width: 100%;"><i class="fa-solid fa-download"></i> Télécharger</button>
                </div>
                <div class="admin-card">
                    <h3 class="admin-card-title"><i class="fa-solid fa-share"></i> WhatsApp</h3>
                    <button class="btn-auth" id="whatsapp-report-btn" style="width: 100%; background: #25D366; color: white;"><i class="fa-brands fa-whatsapp"></i> Envoyer</button>
                </div>
            </div>
        </div>

        <div class="tab-content" id="tab-admin">
            <div class="section-header"><h3 class="section-title"><i class="fa-solid fa-user-shield"></i> Panneau d'administration</h3></div>
            <div class="admin-grid">
                <div class="admin-card">
                    <h3 class="admin-card-title"><i class="fa-solid fa-users"></i> Gestion des employés</h3>
                    <div class="employee-list" id="employee-list"></div>
                    <button class="btn-auth" id="add-employee-btn" style="width: 100%; margin-top: 20px;"><i class="fa-solid fa-user-plus"></i> Ajouter un employé</button>
                </div>
                <div class="admin-card">
                    <h3 class="admin-card-title"><i class="fa-solid fa-database"></i> Exportation</h3>
                    <div class="export-buttons">
                        <button class="btn-export" id="export-sales-btn"><i class="fa-solid fa-chart-line"></i> Ventes</button>
                        <button class="btn-export" id="export-products-btn"><i class="fa-solid fa-box"></i> Produits</button>
                        <button class="btn-export" id="export-logs-btn"><i class="fa-solid fa-history"></i> Historique</button>
                        <button class="btn-export" id="export-all-btn"><i class="fa-solid fa-database"></i> Tout</button>
                    </div>
                </div>
                <div class="admin-card">
                    <h3 class="admin-card-title"><i class="fa-solid fa-sync"></i> Sauvegarde</h3>
                    <p style="color: var(--text-secondary); margin-bottom: 20px;">Dernière sauvegarde: <span id="last-backup">Jamais</span></p>
                    <button class="btn-auth" id="backup-now-btn" style="width: 100%;"><i class="fa-solid fa-cloud-upload-alt"></i> Sauvegarder maintenant</button>
                </div>
            </div>
        </div>
    </div>

    <div class="bottom-bar" id="bottom-nav" style="display:none;">
        <button class="nav-btn active" data-nav="dashboard"><i class="fa-solid fa-chart-line"></i> Tableau</button>
        <button class="nav-btn" data-nav="sales"><i class="fa-solid fa-cash-register"></i> Ventes</button>
        <button class="nav-btn" data-nav="products"><i class="fa-solid fa-box"></i> Produits</button>
        <button class="nav-btn" data-nav="reports"><i class="fa-solid fa-file-alt"></i> Rapports</button>
        <button class="nav-btn admin-only" data-nav="admin" style="display:none;"><i class="fa-solid fa-user-shield"></i> Admin</button>
    </div>

    <div id="modal-add-product" class="modal">
        <div class="modal-content">
            <div class="modal-header"><h3 class="modal-title"><i class="fa-solid fa-plus"></i> Ajouter un produit</h3><button class="close-modal" id="close-add-product-modal"><i class="fa-solid fa-times"></i></button></div>
            <div class="form-group"><label class="form-label">Nom du produit</label><input type="text" id="new-prod-name" class="form-input" placeholder="ex: Bock 66"></div>
            <div class="form-row">
                <div class="form-group"><label class="form-label">Prix (FCFA)</label><input type="number" id="new-prod-price" class="form-input" placeholder="ex: 1000"></div>
                <div class="form-group"><label class="form-label">Stock initial</label><input type="number" id="new-prod-stock" class="form-input" placeholder="ex: 24"></div>
            </div>
            <div class="form-group"><label class="form-label">Catégorie</label><select id="new-prod-category" class="form-select"><option value="beer">Bières</option><option value="soft">Boissons non alcoolisées</option><option value="food">Nourriture</option><option value="other">Autres</option></select></div>
            <div class="modal-footer"><button class="btn-cancel" id="cancel-add-product">Annuler</button><button class="btn-submit" id="submit-add-product">Ajouter</button></div>
        </div>
    </div>

    <div id="modal-quick-sale" class="modal">
        <div class="modal-content">
            <div class="modal-header"><h3 class="modal-title"><i class="fa-solid fa-cash-register"></i> Vente manuelle</h3><button class="close-modal" id="close-quick-sale-modal"><i class="fa-solid fa-times"></i></button></div>
            <div class="form-group"><label class="form-label">Produit</label><select id="sale-product-select" class="form-select"></select></div>
            <div class="form-row">
                <div class="form-group"><label class="form-label">Quantité</label><input type="number" id="sale-quantity" class="form-input" value="1" min="1"></div>
                <div class="form-group"><label class="form-label">Prix unitaire</label><input type="number" id="sale-price" class="form-input" readonly></div>
            </div>
            <div class="form-group"><label class="form-label">Total (FCFA)</label><input type="number" id="sale-total" class="form-input" readonly></div>
            <div class="form-group"><label class="form-label">Notes</label><input type="text" id="sale-notes" class="form-input" placeholder="Notes optionnelles"></div>
            <div class="modal-footer"><button class="btn-cancel" id="cancel-quick-sale">Annuler</button><button class="btn-submit" id="submit-quick-sale">Enregistrer</button></div>
        </div>
    </div>

    <div id="modal-add-expense" class="modal">
        <div class="modal-content">
            <div class="modal-header"><h3 class="modal-title"><i class="fa-solid fa-money-bill-transfer"></i> Ajouter une dépense</h3><button class="close-modal" id="close-expense-modal"><i class="fa-solid fa-times"></i></button></div>
            <div class="form-group"><label class="form-label">Motif</label><input type="text" id="exp-reason" class="form-input" placeholder="ex: Glace, Transport"></div>
            <div class="form-group"><label class="form-label">Montant (FCFA)</label><input type="number" id="exp-amount" class="form-input" placeholder="ex: 5000"></div>
            <div class="form-group"><label class="form-label">Catégorie</label><select id="exp-category" class="form-select"><option value="transport">Transport</option><option value="food">Nourriture</option><option value="supplies">Fournitures</option><option value="maintenance">Entretien</option><option value="other">Autres</option></select></div>
            <div class="modal-footer"><button class="btn-cancel" id="cancel-expense">Annuler</button><button class="btn-submit" id="submit-expense">Enregistrer</button></div>
        </div>
    </div>

    <div id="modal-add-employee" class="modal">
        <div class="modal-content">
            <div class="modal-header"><h3 class="modal-title"><i class="fa-solid fa-user-plus"></i> Nouvel Employé</h3><button class="close-modal" id="close-employee-modal"><i class="fa-solid fa-times"></i></button></div>
            <div class="form-group"><label class="form-label">Nom complet</label><input type="text" id="emp-name" class="form-input" placeholder="ex: Kouassi Jean"></div>
            <div class="form-row">
                <div class="form-group"><label class="form-label">Rôle</label><select id="emp-role" class="form-select"><option value="Serveur">Serveur</option><option value="Caissier">Caissier</option><option value="Gérant">Gérant</option><option value="Sécurité">Sécurité</option></select></div>
                <div class="form-group"><label class="form-label">Téléphone</label><input type="tel" id="emp-phone" class="form-input" placeholder="07..."></div>
            </div>
            <div class="modal-footer"><button class="btn-cancel" id="cancel-employee">Annuler</button><button class="btn-submit" id="submit-employee">Ajouter</button></div>
        </div>
    </div>

    <script type="module">
        // IMPORTATION CDN COMPATIBLE NAVIGATEUR
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-analytics.js";
        import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getFirestore, doc, setDoc, updateDoc, onSnapshot, arrayUnion, getDoc, collection, query, where, getDocs } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        // TA CONFIGURATION (Mise à jour)
        const firebaseConfig = {
          apiKey: "AIzaSyCb22QgS99n6gzYmcCJoPzsVwd1uwg9g7k",
          authDomain: "maquismanager.firebaseapp.com",
          projectId: "maquismanager",
          storageBucket: "maquismanager.firebasestorage.app",
          messagingSenderId: "565292456302",
          appId: "1:565292456302:web:ef737768b5e0f06a05897f",
          measurementId: "G-MWWLQJK1SL"
        };

        const app = initializeApp(firebaseConfig);
        const analytics = getAnalytics(app);
        const auth = getAuth(app);
        const db = getFirestore(app);

        let currentUser = null;
        let currentData = null;
        let isAdmin = false;
        let monthlyChartInstance = null;
        let productChartInstance = null;

        // ELEMENTS
        const els = {
            login: document.getElementById('login-screen'),
            app: document.getElementById('app-container'),
            nav: document.getElementById('bottom-nav'),
            email: document.getElementById('email'),
            pass: document.getElementById('password'),
            msg: document.getElementById('auth-msg'),
            loginBtn: document.getElementById('login-btn'),
            regBtn: document.getElementById('register-btn'),
            logout: document.getElementById('logout-btn'),
            role: document.getElementById('user-role'),
            net: document.getElementById('net-display'),
            ca: document.getElementById('ca-display'),
            exp: document.getElementById('expense-display'),
            sales: document.getElementById('sales-count'),
            stock: document.getElementById('stock-count'),
            tabs: document.querySelectorAll('.tab-btn'),
            contents: document.querySelectorAll('.tab-content'),
            navs: document.querySelectorAll('.nav-btn'),
            adminEls: document.querySelectorAll('.admin-only'),
            loader: document.getElementById('loader'),
            toast: document.getElementById('toast'),
            logs: document.getElementById('logs-list'),
            prods: document.getElementById('products-list'),
            prodsAdmin: document.getElementById('products-list-admin'),
            empList: document.getElementById('employee-list'),
            lastBackup: document.getElementById('last-backup')
        };

        // LISTENERS
        els.loginBtn.addEventListener('click', handleLogin);
        els.regBtn.addEventListener('click', handleRegister);
        els.logout.addEventListener('click', () => signOut(auth));
        
        els.tabs.forEach(btn => btn.addEventListener('click', () => switchTab(btn.dataset.tab)));
        els.navs.forEach(btn => btn.addEventListener('click', () => switchTab(btn.dataset.nav)));
        
        // Modal Triggers
        document.getElementById('add-product-btn').addEventListener('click', () => openModal('modal-add-product'));
        document.getElementById('close-add-product-modal').addEventListener('click', () => closeModal('modal-add-product'));
        document.getElementById('cancel-add-product').addEventListener('click', () => closeModal('modal-add-product'));
        document.getElementById('submit-add-product').addEventListener('click', handleAddProduct);
        
        document.getElementById('quick-sale-btn').addEventListener('click', () => openModal('modal-quick-sale'));
        document.getElementById('close-quick-sale-modal').addEventListener('click', () => closeModal('modal-quick-sale'));
        document.getElementById('cancel-quick-sale').addEventListener('click', () => closeModal('modal-quick-sale'));
        document.getElementById('submit-quick-sale').addEventListener('click', handleQuickSale);
        
        document.getElementById('close-expense-modal').addEventListener('click', () => closeModal('modal-add-expense'));
        document.getElementById('cancel-expense').addEventListener('click', () => closeModal('modal-add-expense'));
        document.getElementById('submit-expense').addEventListener('click', handleAddExpense);

        document.getElementById('add-employee-btn').addEventListener('click', () => openModal('modal-add-employee'));
        document.getElementById('close-employee-modal').addEventListener('click', () => closeModal('modal-add-employee'));
        document.getElementById('cancel-employee').addEventListener('click', () => closeModal('modal-add-employee'));
        document.getElementById('submit-employee').addEventListener('click', handleAddEmployee);

        // Actions
        document.getElementById('product-search').addEventListener('input', () => handleSearch('products-list'));
        document.getElementById('product-search-admin').addEventListener('input', () => handleSearch('products-list-admin'));
        document.getElementById('daily-report-btn').addEventListener('click', () => alertToast('Rapport téléchargé (Simulation)'));
        document.getElementById('whatsapp-report-btn').addEventListener('click', sendWhatsApp);
        document.getElementById('backup-now-btn').addEventListener('click', performBackup);
        document.getElementById('sale-product-select').addEventListener('change', updateSalePrice);
        document.getElementById('sale-quantity').addEventListener('input', updateSaleTotal);

        document.querySelectorAll('.log-filter-btn').forEach(btn => btn.addEventListener('click', function() {
            document.querySelectorAll('.log-filter-btn').forEach(b => b.classList.remove('active'));
            this.classList.add('active');
            filterLogs(this.dataset.filter);
        }));

        // AUTH
        async function handleLogin() {
            const email = els.email.value.trim(), pass = els.pass.value;
            if(!email || !pass) return alertToast('Champs manquants', 'error');
            showLoader(true);
            try {
                await signInWithEmailAndPassword(auth, email, pass);
                alertToast('Connecté !');
            } catch(e) {
                console.error(e);
                els.msg.textContent = "Erreur: " + e.message;
                showLoader(false);
            }
        }

        async function handleRegister() {
            const email = els.email.value.trim(), pass = els.pass.value;
            if(!email || !pass) return alertToast('Champs manquants', 'error');
            showLoader(true);
            try {
                const cred = await createUserWithEmailAndPassword(auth, email, pass);
                await setDoc(doc(db, "maquis", cred.user.uid), {
                    ca_day: 0, expense_day: 0, ca_month: {}, products: [], employees: [], logs: [], salesHistory: [],
                    role: "admin", createdAt: new Date(), lastBackup: new Date()
                });
                alertToast('Compte créé !');
            } catch(e) {
                els.msg.textContent = e.message;
                showLoader(false);
            }
        }

        onAuthStateChanged(auth, async (user) => {
            showLoader(false);
            if(user) {
                currentUser = user;
                try {
                    const snap = await getDoc(doc(db, "maquis", user.uid));
                    if(snap.exists()) {
                        setupApp(snap.data());
                    } else {
                        // Init default data if missing
                        const initData = { ca_day: 0, expense_day: 0, products: [], employees: [], logs: [], role: "admin", lastBackup: new Date() };
                        await setDoc(doc(db, "maquis", user.uid), initData);
                        setupApp(initData);
                    }
                } catch(e) { console.error(e); }
            } else {
                els.login.style.display = 'flex';
                els.app.style.display = 'none';
                els.nav.style.display = 'none';
            }
        });

        function setupApp(data) {
            currentData = data;
            isAdmin = data.role === 'admin';
            els.role.textContent = isAdmin ? 'Administrateur' : 'Employé';
            els.adminEls.forEach(el => el.style.display = isAdmin ? 'flex' : 'none');
            els.login.style.display = 'none';
            els.app.style.display = 'block';
            els.nav.style.display = 'flex';
            
            // Realtime Listener
            onSnapshot(doc(db, "maquis", currentUser.uid), (doc) => {
                if(doc.exists()) {
                    currentData = doc.data();
                    renderUI(currentData);
                    updateSaleSelect(currentData.products);
                }
            });
        }

        function renderUI(data) {
            const ca = data.ca_day || 0, exp = data.expense_day || 0;
            els.net.innerText = (ca - exp).toLocaleString() + " FCFA";
            els.ca.innerText = ca.toLocaleString() + " FCFA";
            els.exp.innerText = exp.toLocaleString() + " FCFA";
            els.sales.innerText = data.salesHistory ? data.salesHistory.length : 0;
            els.stock.innerText = data.products ? data.products.reduce((s, p) => s + p.stock, 0) : 0;

            renderProducts(data.products, 'products-list');
            renderProducts(data.products, 'products-list-admin', true);
            renderLogs(data.logs);
            renderEmployees(data.employees);
            renderCharts(data);

            if (data.lastBackup) {
                 const diff = Math.floor((new Date() - (data.lastBackup.toDate ? data.lastBackup.toDate() : new Date(data.lastBackup))) / 60000);
                 els.lastBackup.textContent = diff < 60 ? `Il y a ${diff} min` : `Il y a ${Math.floor(diff/60)} h`;
            }
        }

        function renderCharts(data) {
            const ctxM = document.getElementById('monthly-chart').getContext('2d');
            const mData = Array(12).fill(0);
            if(data.ca_month) Object.keys(data.ca_month).forEach(k => mData[parseInt(k)-1] = data.ca_month[k]);
            
            if(monthlyChartInstance) monthlyChartInstance.destroy();
            monthlyChartInstance = new Chart(ctxM, {
                type: 'bar',
                data: { labels: ['J','F','M','A','M','J','J','A','S','O','N','D'], datasets: [{ label: 'CA', data: mData, backgroundColor: '#FFD700' }] },
                options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } }, scales: { x: { grid: { display: false }, ticks: { color: '#aaa' } }, y: { grid: { color: '#333' }, ticks: { color: '#aaa' } } } }
            });

            const ctxP = document.getElementById('product-chart').getContext('2d');
            const pSales = {};
            (data.salesHistory || []).forEach(s => pSales[s.productName] = (pSales[s.productName] || 0) + (s.quantity || 1));
            const sorted = Object.entries(pSales).sort((a,b) => b[1]-a[1]).slice(0,5);
            
            if(productChartInstance) productChartInstance.destroy();
            productChartInstance = new Chart(ctxP, {
                type: 'doughnut',
                data: { labels: sorted.map(s => s[0]), datasets: [{ data: sorted.map(s => s[1]), backgroundColor: ['#FFD700', '#FFaa00', '#FF4444', '#33b5e5', '#00C851'], borderWidth: 0 }] },
                options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { position: 'right', labels: { color: '#fff' } } } }
            });
        }

        // PRODUCTS LOGIC
        function renderProducts(list, id, admin = false) {
            const c = document.getElementById(id); c.innerHTML = '';
            if(!list || !list.length) return c.innerHTML = '<p style="text-align:center;color:#666">Aucun produit</p>';
            list.forEach((p, i) => {
                const div = document.createElement('div'); div.className = 'product-item';
                div.innerHTML = `
                    <div class="product-info">
                        <div class="product-icon">${p.category === 'beer' ? '<i class="fa-solid fa-beer"></i>' : '<i class="fa-solid fa-box"></i>'}</div>
                        <div><div class="product-name">${p.name}</div><div class="product-price">${p.price} F</div></div>
                    </div>
                    <div class="product-actions">
                        <span class="stock-badge ${p.stock < 5 ? 'low' : ''}">Stock: ${p.stock}</span>
                        ${admin ? `<button class="btn-edit" onclick="editP(${i})"><i class="fa-solid fa-edit"></i></button><button class="btn-delete" onclick="delP(${i})"><i class="fa-solid fa-trash"></i></button>` : `<button class="btn-sell" onclick="sellP(${i})">Vendre</button>`}
                    </div>`;
                c.appendChild(div);
                // Bind clicks manually to avoid global scope issues
                if(admin) {
                    div.querySelector('.btn-edit').onclick = () => editProduct(i);
                    div.querySelector('.btn-delete').onclick = () => deleteProduct(i);
                } else {
                    div.querySelector('.btn-sell').onclick = () => sellProduct(i);
                }
            });
        }

        async function handleAddProduct() {
            const name = document.getElementById('new-prod-name').value, price = +document.getElementById('new-prod-price').value, stock = +document.getElementById('new-prod-stock').value, cat = document.getElementById('new-prod-category').value;
            if(!name || !price) return alertToast('Erreur', 'error');
            try {
                const list = [...(currentData.products || []), { id: Date.now(), name, price, stock, category: cat }];
                await updateDoc(doc(db, "maquis", currentUser.uid), { products: list });
                alertToast('Produit ajouté'); closeModal('modal-add-product');
            } catch(e) { alertToast(e.message, 'error'); }
        }

        async function sellProduct(i) {
            const p = currentData.products[i];
            if(p.stock < 1) return alertToast('Stock épuisé', 'error');
            const newList = [...currentData.products]; newList[i].stock--;
            const log = { type: 'sale', desc: `Vente: ${p.name}`, time: new Date().toLocaleTimeString(), amount: p.price };
            const rec = { productName: p.name, price: p.price, quantity: 1, time: new Date().toLocaleString() };
            try {
                await updateDoc(doc(db, "maquis", currentUser.uid), {
                    products: newList, ca_day: (currentData.ca_day||0) + p.price,
                    logs: arrayUnion(log), salesHistory: arrayUnion(rec),
                    [`ca_month.${new Date().getMonth()+1}`]: (currentData.ca_month?.[new Date().getMonth()+1] || 0) + p.price
                });
                alertToast('Vendu !');
            } catch(e) { alertToast(e.message, 'error'); }
        }

        async function deleteProduct(i) {
            if(!confirm('Supprimer ?')) return;
            const list = [...currentData.products]; list.splice(i, 1);
            await updateDoc(doc(db, "maquis", currentUser.uid), { products: list });
        }

        async function editProduct(i) {
            const p = currentData.products[i];
            const name = prompt("Nom", p.name); if(!name) return;
            const price = prompt("Prix", p.price); const stock = prompt("Stock", p.stock);
            const list = [...currentData.products]; list[i] = { ...p, name, price: +price, stock: +stock };
            await updateDoc(doc(db, "maquis", currentUser.uid), { products: list });
        }

        // QUICK SALE
        function updateSaleSelect(list) {
            const s = document.getElementById('sale-product-select'); s.innerHTML = '';
            (list||[]).forEach((p, i) => { const o = document.createElement('option'); o.value = i; o.text = p.name; s.add(o); });
            updateSalePrice();
        }
        function updateSalePrice() {
            const i = document.getElementById('sale-product-select').value;
            if(i !== '' && currentData.products[i]) {
                document.getElementById('sale-price').value = currentData.products[i].price;
                updateSaleTotal();
            }
        }
        function updateSaleTotal() {
            document.getElementById('sale-total').value = document.getElementById('sale-price').value * document.getElementById('sale-quantity').value;
        }
        async function handleQuickSale() {
            const i = document.getElementById('sale-product-select').value, qty = +document.getElementById('sale-quantity').value;
            const p = currentData.products[i];
            if(p.stock < qty) return alertToast('Stock insuffisant', 'error');
            const list = [...currentData.products]; list[i].stock -= qty;
            const total = p.price * qty;
            const log = { type: 'sale', desc: `Vente: ${qty}x ${p.name}`, time: new Date().toLocaleTimeString(), amount: total };
            const rec = { productName: p.name, price: p.price, quantity: qty, total, time: new Date().toLocaleString() };
            await updateDoc(doc(db, "maquis", currentUser.uid), {
                products: list, ca_day: (currentData.ca_day||0) + total,
                logs: arrayUnion(log), salesHistory: arrayUnion(rec),
                [`ca_month.${new Date().getMonth()+1}`]: (currentData.ca_month?.[new Date().getMonth()+1] || 0) + total
            });
            alertToast('Vente enregistrée'); closeModal('modal-quick-sale');
        }

        // EMPLOYEES
        function renderEmployees(list) {
            const c = els.empList; c.innerHTML = '';
            if(!list || !list.length) return c.innerHTML = '<p style="text-align:center;color:#666">Aucun employé</p>';
            list.forEach((e, i) => {
                const d = document.createElement('div'); d.className = 'employee-item';
                d.innerHTML = `<div class="employee-avatar">${e.name.charAt(0)}</div><div class="employee-info"><div class="employee-name">${e.name}</div><div class="employee-role">${e.role}</div></div><button class="btn-employee" onclick="delEmp(${i})"><i class="fa-solid fa-trash"></i></button>`;
                c.appendChild(d);
                d.querySelector('.btn-employee').onclick = () => deleteEmployee(i);
            });
        }
        async function handleAddEmployee() {
            const name = document.getElementById('emp-name').value, role = document.getElementById('emp-role').value;
            if(!name) return alertToast('Nom requis', 'error');
            const list = [...(currentData.employees||[]), { name, role, id: Date.now() }];
            await updateDoc(doc(db, "maquis", currentUser.uid), { employees: list });
            alertToast('Employé ajouté'); closeModal('modal-add-employee');
        }
        async function deleteEmployee(i) {
            if(!confirm('Supprimer ?')) return;
            const list = [...currentData.employees]; list.splice(i, 1);
            await updateDoc(doc(db, "maquis", currentUser.uid), { employees: list });
        }

        // EXPENSE
        async function handleAddExpense() {
            const r = document.getElementById('exp-reason').value, a = +document.getElementById('exp-amount').value, c = document.getElementById('exp-category').value;
            if(!r || !a) return alertToast('Erreur', 'error');
            const log = { type: 'expense', desc: `Sortie: ${a}F (${r})`, time: new Date().toLocaleTimeString(), amount: a, category: c };
            await updateDoc(doc(db, "maquis", currentUser.uid), {
                expense_day: (currentData.expense_day||0) + a, logs: arrayUnion(log)
            });
            alertToast('Dépense ajoutée'); closeModal('modal-add-expense');
        }

        // HELPERS
        function renderLogs(logs) {
            els.logs.innerHTML = '';
            (logs||[]).slice(-20).reverse().forEach(l => {
                const d = document.createElement('div'); d.className = 'log-item'; d.dataset.type = l.type;
                let ic = l.type === 'sale' ? 'fa-shopping-cart' : l.type === 'expense' ? 'fa-money-bill-transfer' : 'fa-info';
                d.innerHTML = `<div class="log-content"><div class="log-icon ${l.type}"><i class="fa-solid ${ic}"></i></div><div><div class="log-desc">${l.desc}</div><div class="log-time">${l.time}</div></div></div><div class="log-amount">${l.amount||''} F</div>`;
                els.logs.appendChild(d);
            });
        }
        function filterLogs(t) { document.querySelectorAll('.log-item').forEach(i => i.style.display = (t==='all' || i.dataset.type === t) ? 'flex' : 'none'); }
        function switchTab(t) { 
            els.contents.forEach(c => c.classList.remove('active')); document.getElementById('tab-'+t).classList.add('active');
            els.tabs.forEach(b => b.classList.toggle('active', b.dataset.tab === t));
            els.navs.forEach(b => b.classList.toggle('active', b.dataset.nav === t));
        }
        function openModal(id) { document.getElementById(id).style.display = 'flex'; }
        function closeModal(id) { document.getElementById(id).style.display = 'none'; }
        function showLoader(v) { els.loader.style.display = v ? 'flex' : 'none'; }
        function alertToast(msg, type='success') {
            const t = els.toast; t.textContent = msg; t.className = `toast show ${type}`;
            setTimeout(() => t.classList.remove('show'), 3000);
        }
        function sendWhatsApp() {
            if(!currentData) return;
            let msg = `*📊 RAPPORT MAQUIS*\nRecettes: ${currentData.ca_day} F\nDépenses: ${currentData.expense_day} F\nNET: ${currentData.ca_day - currentData.expense_day} F\n\nStock:\n`;
            currentData.products.forEach(p => msg += `${p.name}: ${p.stock}\n`);
            window.open(`https://wa.me/?text=${encodeURIComponent(msg)}`);
        }
        function handleSearch(id) {
            const v = document.getElementById(id === 'products-list' ? 'product-search' : 'product-search-admin').value.toLowerCase();
            document.querySelectorAll(`#${id} .product-item`).forEach(i => i.style.display = i.textContent.toLowerCase().includes(v) ? 'flex' : 'none');
        }
        async function performBackup() { await updateDoc(doc(db, "maquis", currentUser.uid), { lastBackup: new Date() }); alertToast('Sauvegardé'); }

        showLoader(true);
    </script>
</body>
</html>
